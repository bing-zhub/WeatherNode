The script information for node-red is as follows:
[{"id":"e1ece622.fdaae8","type":"tab","label":"流程1","disabled":false,"info":""},{"id":"8e949148.09018","type":"mysql","z":"e1ece622.fdaae8","mydb":"d074505c.ef4a6","name":"executeSql","x":330,"y":240,"wires":[["844691c2.eddce"]]},{"id":"cc798065.f86b1","type":"debug","z":"e1ece622.fdaae8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":357,"y":609,"wires":[]},{"id":"b6157511.d6aca8","type":"http request","z":"e1ece622.fdaae8","name":"basic","method":"GET","ret":"txt","url":"","tls":"","x":329,"y":119,"wires":[["363407b7.d4c2b8"]]},{"id":"d9f7fc26.e0b7d","type":"function","z":"e1ece622.fdaae8","name":"InsertLocation","func":"latitude = msg.data.basic.coord.lon;\nlongitude = msg.data.basic.coord.lat;\n\nsql = `insert into Location (latitude, longitude) values(${latitude}, ${longitude});`;\nmsg.topic = sql;\nreturn msg;","outputs":1,"noerr":0,"x":105,"y":244,"wires":[["8e949148.09018"]]},{"id":"844691c2.eddce","type":"function","z":"e1ece622.fdaae8","name":"InsertTemp","func":"msg.ids.location = msg.payload.insertId;\n\ntemp_min = msg.data.basic.main.temp_min;\ntemp_max = msg.data.basic.main.temp_max;\n\nsql = `insert into Temp (min, max, t_time) values(${temp_min}, ${temp_max},NOW())`\nmsg.topic = sql;\nreturn msg;","outputs":1,"noerr":0,"x":96,"y":303,"wires":[["8def8c28.bba6a"]]},{"id":"8def8c28.bba6a","type":"mysql","z":"e1ece622.fdaae8","mydb":"d074505c.ef4a6","name":"executeSql","x":305.5,"y":302,"wires":[["53d88e86.ab3a2"]]},{"id":"f1a31fd.d279ce","type":"function","z":"e1ece622.fdaae8","name":"Init","func":"msg = {\n    city:\"\",\n    country:\"\",\n    basic_api:\"\",\n    air_api:\"\",\n    data:{\n        basic:{\n\n        },\n        air:{\n\n        }\n    },\n    topic:\"\",\n    ids:{\n        location:0,\n        temp:0,\n        wind:0,\n        air:0,\n        iaqi:0\n    },\n    payload:{\n        urls:\"\"\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":49,"y":122,"wires":[["ca7c9538.4c2908"]]},{"id":"9aa3f80e.55b358","type":"inject","z":"e1ece622.fdaae8","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":64,"y":14,"wires":[["f1a31fd.d279ce"]]},{"id":"53d88e86.ab3a2","type":"function","z":"e1ece622.fdaae8","name":"InsertWind","func":"msg.ids.temp = msg.payload.insertId;\n\nspeed = msg.data.basic.wind.speed;\ndirection = msg.data.basic.wind.deg;\n\nsql = `insert into Wind (speed, direction) values(${speed}, ${direction});`;\nmsg.topic = sql;\nreturn msg;","outputs":1,"noerr":0,"x":107.5,"y":367,"wires":[["733b54c5.e8865c"]]},{"id":"733b54c5.e8865c","type":"mysql","z":"e1ece622.fdaae8","mydb":"d074505c.ef4a6","name":"executeSql","x":317,"y":366,"wires":[["71061898.090c78"]]},{"id":"71061898.090c78","type":"function","z":"e1ece622.fdaae8","name":"InsertIAQI","func":"msg.ids.wind = msg.payload.insertId;\n\nco = msg.data.air.data.iaqi.co.v;\nno2 = msg.data.air.data.iaqi.no2.v;\no3 = msg.data.air.data.iaqi.o3.v;\np = msg.data.air.data.iaqi.p.v;\npm10 = msg.data.air.data.iaqi.pm10.v;\npm25 = msg.data.air.data.iaqi.pm25.v;\nso2 = msg.data.air.data.iaqi.so2.v;\n\nsql = `insert into IAQI (co, no2, o3, p, pm10, pm25, so2) values(${co}, ${no2}, ${o3}, ${p}, ${pm10}, ${pm25}, ${so2});`;\nmsg.topic = sql;\nreturn msg;","outputs":1,"noerr":0,"x":102.5,"y":430,"wires":[["f02ddfe3.0f86"]]},{"id":"f02ddfe3.0f86","type":"mysql","z":"e1ece622.fdaae8","mydb":"d074505c.ef4a6","name":"executeSql","x":322,"y":429,"wires":[["93176c16.c692a"]]},{"id":"93176c16.c692a","type":"function","z":"e1ece622.fdaae8","name":"InsertAirQuality","func":"msg.ids.iaqi = msg.payload.insertId;\n\nvar reg =/[\\u4e00-\\u9fa5]/g;\naqi = msg.data.air.data.aqi;\npublish_platform = msg.data.air.data.attributions[0].name.replace(reg, \"\");\ndominent_pol= msg.data.air.data.dominentpol;\niaqi = msg.ids.iaqi;\n\nsql = `insert into AirQuality (aqi, publish_platform, dominent_pol, iaqi) values(${aqi}, '${publish_platform}\\', '${dominent_pol}\\', ${iaqi});`;\nmsg.topic = sql;\nreturn msg;","outputs":1,"noerr":0,"x":122,"y":491,"wires":[["86998c43.61605"]]},{"id":"86998c43.61605","type":"mysql","z":"e1ece622.fdaae8","mydb":"d074505c.ef4a6","name":"executeSql","x":324.5,"y":491,"wires":[["b3e61c7a.9843"]]},{"id":"b3e61c7a.9843","type":"function","z":"e1ece622.fdaae8","name":"InsertWeather","func":"msg.ids.air = msg.payload.insertId;\n\ndetail = msg.data.basic.weather[0].main;\ntemp = msg.ids.temp;\npressure= msg.data.basic.main.pressure;\nair_quality = msg.ids.air;\nlocation = msg.ids.location;\nwind = msg.ids.wind;\n\nsql = `insert into Weather (detail, temp, wind, pressure, air_quality, location, w_time) values('${detail}\\', ${temp}, ${wind} ,${pressure}, ${air_quality}, ${location} , now());`;\nmsg.topic = sql;\nreturn msg;","outputs":1,"noerr":0,"x":111,"y":565,"wires":[["8a3b4935.51c028","cc798065.f86b1"]]},{"id":"8a3b4935.51c028","type":"mysql","z":"e1ece622.fdaae8","mydb":"d074505c.ef4a6","name":"executeSql","x":367.5,"y":562,"wires":[[]]},{"id":"37462ab4.3bc776","type":"function","z":"e1ece622.fdaae8","name":"setBasic&changeUrl","func":"msg.data.basic = msg.payload;\nmsg.url = msg.air_api;\nreturn msg;","outputs":1,"noerr":0,"x":693,"y":115,"wires":[["1d899711.fc6af9"]]},{"id":"1d899711.fc6af9","type":"http request","z":"e1ece622.fdaae8","name":"air","method":"GET","ret":"txt","url":"","tls":"","x":106.5,"y":180,"wires":[["4b6d08ac.ae4398"]]},{"id":"e1b69ad.6e45e68","type":"function","z":"e1ece622.fdaae8","name":"setAir","func":"msg.data.air = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":371.5,"y":179,"wires":[["d9f7fc26.e0b7d","3b1a2f1.3b202d","64376da5.aade74","ef810368.2f27a","c719bd86.e7604","53852cfd.859424","2331682e.0ee9c8","c7f061f8.5367e","5526cc55.377944","6fca77a4.ce76a8","26018a18.275ec6","33f610f3.1309e","7c61fbeb.456034","f068b1d.0c8ec5","de8a7671.9eea78","b965eacb.a95e08","c02e8e26.34de7","c1279c47.701f8","8cd5fce8.8e7ef"]]},{"id":"363407b7.d4c2b8","type":"json","z":"e1ece622.fdaae8","name":"","property":"payload","action":"","pretty":false,"x":471.5,"y":114,"wires":[["37462ab4.3bc776"]]},{"id":"4b6d08ac.ae4398","type":"json","z":"e1ece622.fdaae8","name":"","property":"payload","action":"","pretty":false,"x":234.5,"y":181,"wires":[["e1b69ad.6e45e68"]]},{"id":"ca7c9538.4c2908","type":"function","z":"e1ece622.fdaae8","name":"config","func":"city = \"London\";\ncountry = \"UK\"; // 这里改地址\nbasic_token = \"b96a0965fd87a84117defe7d37526a85\";//这里是openweathermap的api\nair_token = \"08ae63f6a0bf92aeecb19873d9b00c1ffc746676\"; //这里是获取空气质量的api\n\nmsg.city = city;\nmsg.country = country;\nmsg.basic_api = `http://api.openweathermap.org/data/2.5/weather?q=${city},${country}&appid=${basic_token}`;\nmsg.air_api = `https://api.waqi.info/feed/${city}/?token=${air_token}`;\n\nmsg.url = msg.basic_api;\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":120,"wires":[["b6157511.d6aca8"]]},{"id":"3b1a2f1.3b202d","type":"ui_text","z":"e1ece622.fdaae8","group":"f635abed.28b2c8","order":1,"width":"6","height":"1","name":"","label":"Desciption","format":"{{msg.data.basic.weather[0].main}} ","layout":"row-spread","x":712.5,"y":375,"wires":[]},{"id":"64376da5.aade74","type":"ui_gauge","z":"e1ece622.fdaae8","name":"","group":"f635abed.28b2c8","order":3,"width":"6","height":"6","gtype":"gage","title":"Temperature","label":"°F","format":"{{msg.data.basic.main.temp}}","min":"270","max":"300","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":712.5,"y":455,"wires":[]},{"id":"ef810368.2f27a","type":"ui_text","z":"e1ece622.fdaae8","group":"5060a49.3dea35c","order":0,"width":"8","height":"1","name":"","label":"City","format":"{{msg.city}}","layout":"row-spread","x":692.5,"y":175,"wires":[]},{"id":"c719bd86.e7604","type":"ui_gauge","z":"e1ece622.fdaae8","name":"","group":"f635abed.28b2c8","order":4,"width":"6","height":"6","gtype":"wave","title":"Pressure","label":"Pa","format":"{{msg.data.basic.main.pressure}}","min":"970","max":"1300","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":702.5,"y":535,"wires":[]},{"id":"53852cfd.859424","type":"ui_text","z":"e1ece622.fdaae8","group":"f635abed.28b2c8","order":2,"width":"6","height":"1","name":"","label":"Visibility","format":"{{msg.data.basic.visibility}}m","layout":"row-spread","x":702.5,"y":415,"wires":[]},{"id":"2331682e.0ee9c8","type":"ui_gauge","z":"e1ece622.fdaae8","name":"","group":"f635abed.28b2c8","order":3,"width":"6","height":"6","gtype":"gage","title":"Humidity","label":"%","format":"{{msg.data.basic.main.humidity}}","min":"50","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":702.5,"y":495,"wires":[]},{"id":"c7f061f8.5367e","type":"ui_text","z":"e1ece622.fdaae8","group":"5060a49.3dea35c","order":0,"width":"8","height":"1","name":"","label":"Country","format":"{{msg.country}}","layout":"row-spread","x":702.5,"y":215,"wires":[]},{"id":"d994d273.aa17a","type":"ui_button","z":"e1ece622.fdaae8","name":"","group":"5060a49.3dea35c","order":2,"width":"6","height":"1","passthru":false,"label":"GetWeather","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":232.5,"y":55,"wires":[["f1a31fd.d279ce"]]},{"id":"5526cc55.377944","type":"ui_text","z":"e1ece622.fdaae8","group":"f4c20e29.cf16d","order":0,"width":0,"height":0,"name":"","label":"AQI","format":"{{msg.data.air.data.aqi}}","layout":"row-spread","x":952.5,"y":235,"wires":[]},{"id":"6fca77a4.ce76a8","type":"ui_text","z":"e1ece622.fdaae8","group":"f4c20e29.cf16d","order":1,"width":0,"height":0,"name":"","label":"Attributor","format":"{{msg.data.air.data.attributions[0].name}}","layout":"row-spread","x":962.5,"y":275,"wires":[]},{"id":"26018a18.275ec6","type":"ui_text","z":"e1ece622.fdaae8","group":"f4c20e29.cf16d","order":1,"width":0,"height":0,"name":"","label":"DominentPollution","format":"{{msg.data.air.data.dominentpol}}","layout":"row-spread","x":992.5,"y":315,"wires":[]},{"id":"33f610f3.1309e","type":"ui_text","z":"e1ece622.fdaae8","group":"44415a95.2148e4","order":0,"width":0,"height":0,"name":"","label":"CO","format":"{{msg.data.air.data.iaqi.co.v}}","layout":"row-spread","x":972.5,"y":395,"wires":[]},{"id":"b965eacb.a95e08","type":"ui_text","z":"e1ece622.fdaae8","group":"44415a95.2148e4","order":0,"width":0,"height":0,"name":"","label":"PM10","format":"{{msg.data.air.data.iaqi.pm10.v}}","layout":"row-spread","x":972.5,"y":555,"wires":[]},{"id":"7c61fbeb.456034","type":"ui_text","z":"e1ece622.fdaae8","group":"44415a95.2148e4","order":0,"width":0,"height":0,"name":"","label":"NO2","format":"{{msg.data.air.data.iaqi.no2.v}}","layout":"row-spread","x":972.5,"y":435,"wires":[]},{"id":"f068b1d.0c8ec5","type":"ui_text","z":"e1ece622.fdaae8","group":"44415a95.2148e4","order":0,"width":0,"height":0,"name":"","label":"O3","format":"{{msg.data.air.data.iaqi.o3.v}}","layout":"row-spread","x":972.5,"y":475,"wires":[]},{"id":"de8a7671.9eea78","type":"ui_text","z":"e1ece622.fdaae8","group":"44415a95.2148e4","order":0,"width":0,"height":0,"name":"","label":"P","format":"{{msg.data.air.data.iaqi.p.v}}","layout":"row-spread","x":972.5,"y":515,"wires":[]},{"id":"c02e8e26.34de7","type":"ui_text","z":"e1ece622.fdaae8","group":"44415a95.2148e4","order":0,"width":0,"height":0,"name":"","label":"PM25","format":"{{msg.data.air.data.iaqi.pm25.v}}","layout":"row-spread","x":972.5,"y":595,"wires":[]},{"id":"c1279c47.701f8","type":"ui_text","z":"e1ece622.fdaae8","group":"44415a95.2148e4","order":0,"width":0,"height":0,"name":"","label":"SO2","format":"{{msg.data.air.data.iaqi.so2.v}}","layout":"row-spread","x":972.5,"y":635,"wires":[]},{"id":"8cd5fce8.8e7ef","type":"ui_gauge","z":"e1ece622.fdaae8","name":"","group":"f635abed.28b2c8","order":3,"width":"6","height":"6","gtype":"donut","title":"WindDirection","label":"degree","format":"{{msg.data.basic.wind.deg}}","min":"0","max":"360","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":722.5,"y":575,"wires":[]},{"id":"d074505c.ef4a6","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"Project","tz":""},{"id":"f635abed.28b2c8","type":"ui_group","z":"","name":"Basic","tab":"6be9cbcb.c97dc4","order":2,"disp":true,"width":"12","collapse":false},{"id":"5060a49.3dea35c","type":"ui_group","z":"","name":"Info","tab":"6be9cbcb.c97dc4","order":1,"disp":true,"width":"24","collapse":false},{"id":"f4c20e29.cf16d","type":"ui_group","z":"","name":"AirQuality","tab":"6be9cbcb.c97dc4","disp":true,"width":"12","collapse":false},{"id":"44415a95.2148e4","type":"ui_group","z":"","name":"IAQI","tab":"6be9cbcb.c97dc4","order":4,"disp":true,"width":"12","collapse":false},{"id":"6be9cbcb.c97dc4","type":"ui_tab","z":"","name":"Weather","icon":"Dashboard","disabled":false,"hidden":false}]

